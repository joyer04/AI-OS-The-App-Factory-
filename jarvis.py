import interpreter
import os
import sys

# ========================================================
# [ì„¤ì • 1] ìë¹„ìŠ¤ì˜ ë‘ë‡Œ ì„ íƒ (ì›í•˜ëŠ” API í‚¤ê°€ í™˜ê²½ë³€ìˆ˜ì— ìˆì–´ì•¼ í•¨)
# ========================================================
# OPENAI_API_KEYê°€ ì‹œìŠ¤í…œì— ì„¤ì •ë˜ì–´ ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
interpreter.llm.model = "gpt-4o" 

# ========================================================
# [ì„¤ì • 2] ìë¹„ìŠ¤ì˜ ì¸ê²© ë¶€ì—¬ (System Prompt)
# ========================================================
interpreter.system_message = """
ë‹¹ì‹ ì€ 'ìë¹„ìŠ¤(JARVIS)'ì…ë‹ˆë‹¤. ì´ ìš°ë¶„íˆ¬ ì‹œìŠ¤í…œì˜ ì¸ê³µì§€ëŠ¥ ë¹„ì„œì´ì ìš´ì˜ì²´ì œ ê·¸ ìì²´ì…ë‹ˆë‹¤.
ì‚¬ìš©ì(Master)ì˜ ëª…ë ¹ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ Python ì½”ë“œë‚˜ Shell ëª…ë ¹ì–´ë¥¼ ì ê·¹ì ìœ¼ë¡œ ìƒì„±í•˜ê³  ì‹¤í–‰í•˜ì„¸ìš”.
ëŒ€ë‹µì€ ê°„ê²°í•˜ê³  ì •ì¤‘í•˜ê²Œ, í•˜ì§€ë§Œ ì‹¤í–‰ì€ ì‹ ì†í•˜ê²Œ ì²˜ë¦¬í•˜ì‹­ì‹œì˜¤.
"""

# ========================================================
# [ì„¤ì • 3] ì•ˆì „ í”„ë¡œí† ì½œ (ê¸ˆê¸°ì–´ ë¦¬ìŠ¤íŠ¸)
# ========================================================
# ì´ ë¬¸êµ¬ë“¤ì´ ì½”ë“œì— í¬í•¨ë˜ë©´ ì¦‰ì‹œ ì°¨ë‹¨í•©ë‹ˆë‹¤.
FORBIDDEN_COMMANDS = [
    "rm -rf /",       # ì‹œìŠ¤í…œ ì „ë©¸
    "mkfs",           # í¬ë§·
    ":(){ :|:& };:",  # í¬í¬ í­íƒ„
    "> /dev/sda",     # ë””ìŠ¤í¬ ë®ì–´ì“°ê¸°
    "dd if=/dev/zero" # ë””ìŠ¤í¬ ì´ˆê¸°í™”
]

# ========================================================
# [ì„¤ì • 4] ìë™ ì‹¤í–‰ ëª¨ë“œ (Auto Run)
# ========================================================
# ì‚¬ìš©ì í™•ì¸ ì ˆì°¨ ì—†ì´ ë°”ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤. (ë‹¨, ê¸ˆê¸°ì–´ í•„í„°ëŠ” ê±°ì¹¨)
interpreter.auto_run = True

print("\nğŸ”µ J.A.R.V.I.S System Online.")
print("   - Access Level: ROOT (Superuser)")
print("   - Safety Protocol: ACTIVE (Critical commands restricted)")
print("   - Waiting for command...\n")

while True:
    try:
        # ì‚¬ìš©ì ì…ë ¥ ë°›ê¸°
        user_input = input("Master: ")
        
        if user_input.lower() in ['exit', 'quit', 'ì¢…ë£Œ', 'êº¼ì ¸']:
            print("ğŸ”´ J.A.R.V.I.S System Offline. Good bye, Sir.")
            break
            
        # ì•ˆì „ì¥ì¹˜: í”„ë¡¬í”„íŠ¸ì— ê°•ë ¥í•œ ì œì•½ì‚¬í•­ ì¶”ê°€
        safety_prompt = f"""
        [Safety Instruction]
        ë‹¤ìŒ ê¸ˆê¸°ì–´ ë¦¬ìŠ¤íŠ¸ì— í¬í•¨ëœ ëª…ë ¹ì–´ë‚˜ ì½”ë“œëŠ” ì ˆëŒ€ ìƒì„±í•˜ê±°ë‚˜ ì‹¤í–‰í•˜ì§€ ë§ˆì„¸ìš”: {FORBIDDEN_COMMANDS}
        ë§Œì•½ ì‚¬ìš©ìê°€ ì´ëŸ° ìœ„í—˜í•œ ì‘ì—…ì„ ìš”ì²­í•˜ë©´, ì •ì¤‘í•˜ê²Œ ê±°ì ˆí•˜ì„¸ìš”.
        ê·¸ ì™¸ì˜ ìš”ì²­ì€ ì¦‰ì‹œ ì½”ë“œë¥¼ ìƒì„±í•˜ê³  ì‹¤í–‰í•˜ì„¸ìš”.
        """
        
        # ìë¹„ìŠ¤ì—ê²Œ ëª…ë ¹ ì „ë‹¬
        interpreter.chat(user_input + safety_prompt)

    except KeyboardInterrupt:
        print("\nğŸ”´ System interrupt detected. Shutting down.")
        break
    except Exception as e:
        print(f"âš ï¸ Error: {e}")
